{% extends "content/internal/base_internal.html" %}

{% block title %}–†–µ–¥–∞–∫—Ç–æ—Ä —Ä–∞–∑–¥–µ–ª–æ–≤{% endblock %}

{% block content %}

<h1>–†–µ–¥–∞–∫—Ç–æ—Ä —Ä–∞–∑–¥–µ–ª–æ–≤</h1>

<div style="margin-bottom: 1.5rem; display:flex; gap:12px;">
  <a href="{% url 'create_section' %}" class="btn btn-primary">
    ‚ûï –ù–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª
  </a>
  <a href="{% url 'dashboard' %}" class="btn btn-secondary">
    ‚Üê –ù–∞–∑–∞–¥
  </a>
</div>

<div class="dashboard-card">

<table class="dashboard-table">
  <thead>
    <tr>
      <th>–†–∞–∑–¥–µ–ª</th>
      <th>–ö–∞—Ç–∞–ª–æ–≥</th>
      <th>–¢–∏–ø</th>
      <th>–°—Ç–∞—Ç–µ–π</th>
      <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
  </thead>

<tbody>
{% for section in page_obj %}
  <tr>

    {# ===== –ù–ê–ó–í–ê–ù–ò–ï + –ò–ï–†–ê–†–•–ò–Ø ===== #}
    <td class="col-title">

      {% if section.parent and section.parent.parent %}
        <div style="margin-left:32px">
          <span class="badge badge-light">–∫–æ–Ω—Ç–µ–Ω—Ç–Ω—ã–π</span>
          <div class="post-title">{{ section.title }}</div>
          <div class="post-section">
            {{ section.parent.title }} ‚Üí {{ section.parent.parent.title }}
          </div>
        </div>

      {% elif section.parent %}
        <div style="margin-left:16px">
          <span class="badge badge-secondary">–ø–æ–¥—Ä–∞–∑–¥–µ–ª</span>
          <div class="post-title">{{ section.title }}</div>
          <div class="post-section">
            —Ä–æ–¥–∏—Ç–µ–ª—å: {{ section.parent.title }}
          </div>
        </div>

      {% else %}
        <div>
          <span class="badge badge-primary">–∫–æ—Ä–Ω–µ–≤–æ–π</span>
          <div class="post-title">{{ section.title }}</div>
        </div>
      {% endif %}

    </td>

    {# ===== –ö–ê–¢–ê–õ–û–ì ===== #}
    <td>
      {{ section.catalog.title }}
    </td>

    {# ===== –¢–ò–ü (–°–ú–´–°–õ–û–í–û–ô) ===== #}
    <td>
      {% if section.parent and section.parent.parent %}
        <span class="status status-published">–∫–æ–Ω—Ç–µ–Ω—Ç</span>
      {% elif section.parent %}
        <span class="status status-draft">–≥—Ä—É–ø–ø–∞</span>
      {% else %}
        <span class="status status-archived">–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä</span>
      {% endif %}
    </td>

    {# ===== –°–¢–ê–¢–ï–ô ===== #}
    <td>
      {% if section.posts_count %}
        {{ section.posts_count }}
      {% else %}
        <span class="muted">‚Äî</span>
      {% endif %}
    </td>

    {# ===== –î–ï–ô–°–¢–í–ò–Ø ===== #}
    <td class="col-actions">
      <div class="actions-group">

        <a href="{% url 'edit_section' section.slug %}"
           class="action-btn action-edit"
           title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>

        <form action="{% url 'delete_section' section.slug %}"
              method="post"
              onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —Ä–∞–∑–¥–µ–ª? –í –Ω—ë–º –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å—Ç–∞—Ç–µ–π.');">
          {% csrf_token %}
          <button type="submit"
                  class="action-btn action-delete"
                  title="–£–¥–∞–ª–∏—Ç—å">üóë</button>
        </form>

      </div>
    </td>

  </tr>
{% empty %}
  <tr>
    <td colspan="5">–†–∞–∑–¥–µ–ª–æ–≤ –Ω–µ—Ç</td>
  </tr>
{% endfor %}
</tbody>

</table>

</div>

{# ===== –ü–ê–ì–ò–ù–ê–¶–ò–Ø (–ö–†–ê–°–ò–í–ê–Ø, –ö–ê–ö –í–ï–ó–î–ï) ===== #}
{% if page_obj and page_obj.has_other_pages %}
  <nav class="pagination">

    {% if page_obj.has_previous %}
      <a class="page-nav"
         href="?page={{ page_obj.previous_page_number }}">
        ‚Üê
      </a>
    {% endif %}

    {% for num in page_obj.paginator.page_range %}
      {% if num == page_obj.number %}
        <span class="page-number active">{{ num }}</span>
      {% elif num > page_obj.number|add:"-3" and num < page_obj.number|add:"3" %}
        <a class="page-number"
           href="?page={{ num }}">
          {{ num }}
        </a>
      {% endif %}
    {% endfor %}

    {% if page_obj.has_next %}
      <a class="page-nav"
         href="?page={{ page_obj.next_page_number }}">
        ‚Üí
      </a>
    {% endif %}

  </nav>
{% endif %}

{% endblock %}
